============================================================
MESHTASTIC-MATRIX BRIDGE TEST SUITE
============================================================
Running 7 test files...

============================================================
Running: /home/engine/project/tests/test_bridge.py
============================================================
/home/engine/project/src/bridge.py:27: DeprecationWarning: There is no current event loop
  self.loop = asyncio.get_event_loop()
..../usr/lib/python3.12/asyncio/base_events.py:726: ResourceWarning: unclosed event loop <_UnixSelectorEventLoop running=False closed=False debug=False>
  _warn(f"unclosed event loop {self!r}", ResourceWarning, source=self)
ResourceWarning: Enable tracemalloc to get the object allocation traceback
..
----------------------------------------------------------------------
Ran 6 tests in 1.013s

OK


============================================================
Running: /home/engine/project/tests/test_coverage_extended.py
============================================================
/home/engine/project/src/bridge.py:27: DeprecationWarning: There is no current event loop
  self.loop = asyncio.get_event_loop()
...Missing required configuration: MATRIX_HOMESERVER, MATRIX_USER, MATRIX_PASSWORD, MATRIX_ROOM_ID
.Missing required configuration: MATRIX_HOMESERVER, MATRIX_USER, MATRIX_PASSWORD, MATRIX_ROOM_ID
....../usr/lib/python3.12/asyncio/base_events.py:726: ResourceWarning: unclosed event loop <_UnixSelectorEventLoop running=False closed=False debug=False>
  _warn(f"unclosed event loop {self!r}", ResourceWarning, source=self)
ResourceWarning: Enable tracemalloc to get the object allocation traceback
.......EEEEE
======================================================================
ERROR: test_extract_channel_name_from_topic (__main__.TestUtilityFunctions.test_extract_channel_name_from_topic)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/engine/project/tests/test_coverage_extended.py", line 277, in test_extract_channel_name_from_topic
    from utils import extract_channel_name_from_topic
ModuleNotFoundError: No module named 'utils'

======================================================================
ERROR: test_extract_channel_name_unknown (__main__.TestUtilityFunctions.test_extract_channel_name_unknown)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/engine/project/tests/test_coverage_extended.py", line 282, in test_extract_channel_name_unknown
    from utils import extract_channel_name_from_topic
ModuleNotFoundError: No module named 'utils'

======================================================================
ERROR: test_is_emoji_only_false (__main__.TestUtilityFunctions.test_is_emoji_only_false)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/engine/project/tests/test_coverage_extended.py", line 293, in test_is_emoji_only_false
    from utils import is_emoji_only
ModuleNotFoundError: No module named 'utils'

======================================================================
ERROR: test_is_emoji_only_true (__main__.TestUtilityFunctions.test_is_emoji_only_true)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/engine/project/tests/test_coverage_extended.py", line 287, in test_is_emoji_only_true
    from utils import is_emoji_only
ModuleNotFoundError: No module named 'utils'

======================================================================
ERROR: test_node_id_to_str (__main__.TestUtilityFunctions.test_node_id_to_str)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/engine/project/tests/test_coverage_extended.py", line 272, in test_node_id_to_str
    from utils import node_id_to_str
ModuleNotFoundError: No module named 'utils'

----------------------------------------------------------------------
Ran 22 tests in 0.015s

FAILED (errors=5)


============================================================
Running: /home/engine/project/tests/test_database.py
============================================================
EE....E.E....
======================================================================
ERROR: test_database_initialization (__main__.TestNodeDatabase.test_database_initialization)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/engine/project/tests/test_database.py", line 22, in test_database_initialization
    cursor = conn.cursor()
             ^^^^^^^^^^^
AttributeError: '_GeneratorContextManager' object has no attribute 'cursor'

======================================================================
ERROR: test_get_all_nodes (__main__.TestNodeDatabase.test_get_all_nodes)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/engine/project/tests/test_database.py", line 79, in test_get_all_nodes
    node_ids = [n['node_id'] for n in nodes]
                ~^^^^^^^^^^^
TypeError: tuple indices must be integers or slices, not str

======================================================================
ERROR: test_save_message_state (__main__.TestNodeDatabase.test_save_message_state)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/engine/project/tests/test_database.py", line 101, in test_save_message_state
    self.assertEqual(loaded.text, "Test message")
                     ^^^^^^^^^^^
AttributeError: 'MessageState' object has no attribute 'text'

======================================================================
ERROR: test_update_message_state (__main__.TestNodeDatabase.test_update_message_state)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/engine/project/tests/test_database.py", line 145, in test_update_message_state
    self.assertEqual(loaded.text, "Updated")
                     ^^^^^^^^^^^
AttributeError: 'MessageState' object has no attribute 'text'

----------------------------------------------------------------------
Ran 13 tests in 0.039s

FAILED (errors=4)


============================================================
Running: /home/engine/project/tests/test_matrix_bot.py
============================================================
....EF..../home/engine/project/src/adapters/matrix_bot.py:45: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
  self.client.add_event_callback(self._on_room_message, RoomMessageText)
RuntimeWarning: Enable tracemalloc to get the object allocation traceback
/home/engine/project/src/adapters/matrix_bot.py:46: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
  self.client.add_event_callback(self._on_reaction, ReactionEvent)
RuntimeWarning: Enable tracemalloc to get the object allocation traceback
.F
======================================================================
ERROR: test_on_reaction (__main__.TestMatrixBot.test_on_reaction)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/usr/lib/python3.12/unittest/mock.py", line 1390, in patched
    return func(*newargs, **newkeywargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/engine/project/tests/test_matrix_bot.py", line 274, in test_on_reaction
    asyncio.run(run())
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 687, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/home/engine/project/tests/test_matrix_bot.py", line 269, in run
    await bot._on_reaction(room, event)
  File "/home/engine/project/src/adapters/matrix_bot.py", line 150, in _on_reaction
    content = event.source.get('content', {})
              ^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 658, in __getattr__
    raise AttributeError("Mock object has no attribute %r" % name)
AttributeError: Mock object has no attribute 'source'

======================================================================
FAIL: test_on_room_message_filters_own_messages (__main__.TestMatrixBot.test_on_room_message_filters_own_messages)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/usr/lib/python3.12/unittest/mock.py", line 1390, in patched
    return func(*newargs, **newkeywargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/engine/project/tests/test_matrix_bot.py", line 194, in test_on_room_message_filters_own_messages
    asyncio.run(run())
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 687, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/home/engine/project/tests/test_matrix_bot.py", line 192, in run
    self.bridge.handle_matrix_message.assert_not_called()
  File "/usr/lib/python3.12/unittest/mock.py", line 905, in assert_not_called
    raise AssertionError(msg)
AssertionError: Expected 'handle_matrix_message' to not have been called. Called 1 times.
Calls: [call(<MagicMock spec='RoomMessageText' id='139914414074976'>)].

======================================================================
FAIL: test_stop (__main__.TestMatrixBot.test_stop)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/usr/lib/python3.12/unittest/mock.py", line 1390, in patched
    return func(*newargs, **newkeywargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/engine/project/tests/test_matrix_bot.py", line 293, in test_stop
    asyncio.run(run())
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 687, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/home/engine/project/tests/test_matrix_bot.py", line 290, in run
    self.assertFalse(bot.running)
AssertionError: True is not false

----------------------------------------------------------------------
Ran 12 tests in 0.015s

FAILED (failures=2, errors=1)


============================================================
Running: /home/engine/project/tests/test_meshtastic_interface.py
============================================================
/usr/lib/python3.12/asyncio/base_events.py:712: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
  self._ready.clear()
RuntimeWarning: Enable tracemalloc to get the object allocation traceback
.......FF..
======================================================================
FAIL: test_send_text (__main__.TestMeshtasticInterface.test_send_text)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/usr/lib/python3.12/unittest/mock.py", line 1390, in patched
    return func(*newargs, **newkeywargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/engine/project/tests/test_meshtastic_interface.py", line 53, in test_send_text
    mock_interface.sendText.assert_called_once_with(
  File "/usr/lib/python3.12/unittest/mock.py", line 956, in assert_called_once_with
    return self.assert_called_with(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 944, in assert_called_with
    raise AssertionError(_error_message()) from cause
AssertionError: expected call not found.
Expected: sendText('Hello World', channelIndex=0)
  Actual: sendText('Hello World', channelIndex=0, replyId=None)

======================================================================
FAIL: test_send_text_with_reply (__main__.TestMeshtasticInterface.test_send_text_with_reply)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/usr/lib/python3.12/unittest/mock.py", line 1390, in patched
    return func(*newargs, **newkeywargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/engine/project/tests/test_meshtastic_interface.py", line 72, in test_send_text_with_reply
    mock_interface.sendText.assert_called_once_with(
  File "/usr/lib/python3.12/unittest/mock.py", line 956, in assert_called_once_with
    return self.assert_called_with(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 944, in assert_called_with
    raise AssertionError(_error_message()) from cause
AssertionError: expected call not found.
Expected: sendText('Reply text', channelIndex=0)
  Actual: sendText('Reply text', channelIndex=0, replyId=77777)

----------------------------------------------------------------------
Ran 11 tests in 0.007s

FAILED (failures=2)


============================================================
Running: /home/engine/project/tests/test_mqtt_client.py
============================================================
EError processing NODEINFO: 'dict' object has no attribute 'from'
Traceback (most recent call last):
  File "/home/engine/project/src/adapters/mqtt_client.py", line 201, in _handle_nodeinfo
    node_id = node_id_to_str(getattr(packet, 'from'))
                             ^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'dict' object has no attribute 'from'
.FFailed to connect to MQTT, return code 5
..Event loop not set - unable to schedule message handling
..Failed to decrypt packet 777: Invalid key size (8) for AES.
.
======================================================================
ERROR: test_extract_channel_name_from_topic (__main__.TestMQTTClient.test_extract_channel_name_from_topic)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/usr/lib/python3.12/unittest/mock.py", line 1390, in patched
    return func(*newargs, **newkeywargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/engine/project/tests/test_mqtt_client.py", line 76, in test_extract_channel_name_from_topic
    from utils import extract_channel_name_from_topic
ModuleNotFoundError: No module named 'utils'

======================================================================
FAIL: test_initialization (__main__.TestMQTTClient.test_initialization)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/usr/lib/python3.12/unittest/mock.py", line 1390, in patched
    return func(*newargs, **newkeywargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/engine/project/tests/test_mqtt_client.py", line 24, in test_initialization
    self.assertIsNone(client.client)
AssertionError: <MagicMock name='mqtt.Client()' id='129645154600096'> is not None

----------------------------------------------------------------------
Ran 8 tests in 0.009s

FAILED (failures=1, errors=1)


============================================================
Running: /home/engine/project/tests/test_bridge_advanced.py
============================================================
/home/engine/project/src/bridge.py:27: DeprecationWarning: There is no current event loop
  self.loop = asyncio.get_event_loop()
F....F.FF.E...E./usr/lib/python3.12/asyncio/base_events.py:726: ResourceWarning: unclosed event loop <_UnixSelectorEventLoop running=False closed=False debug=False>
  _warn(f"unclosed event loop {self!r}", ResourceWarning, source=self)
ResourceWarning: Enable tracemalloc to get the object allocation traceback
E....FEF.....F..E
======================================================================
ERROR: test_handle_matrix_message_with_reply_fallback (__main__.TestBridgeAdvanced.test_handle_matrix_message_with_reply_fallback)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/engine/project/tests/test_bridge_advanced.py", line 462, in test_handle_matrix_message_with_reply_fallback
    asyncio.run(run())
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 687, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/home/engine/project/tests/test_bridge_advanced.py", line 444, in run
    self.bridge.matrix_event_to_packet[("$original_evt", 0)] = 5555
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'MeshtasticMatrixBridge' object has no attribute 'matrix_event_to_packet'

======================================================================
ERROR: test_handle_new_message_stores_state (__main__.TestBridgeAdvanced.test_handle_new_message_stores_state)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/engine/project/tests/test_bridge_advanced.py", line 181, in test_handle_new_message_stores_state
    asyncio.run(run())
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 687, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/home/engine/project/tests/test_bridge_advanced.py", line 178, in run
    self.assertEqual(state.text, "New message")
                     ^^^^^^^^^^
AttributeError: 'MessageState' object has no attribute 'text'

======================================================================
ERROR: test_handle_reply_message_orphan_reply (__main__.TestBridgeAdvanced.test_handle_reply_message_orphan_reply)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/engine/project/tests/test_bridge_advanced.py", line 254, in test_handle_reply_message_orphan_reply
    asyncio.run(run())
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 687, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/home/engine/project/tests/test_bridge_advanced.py", line 252, in run
    self.assertIsNone(call_args[1]['reply_to'])
                      ~~~~~~~~~~~~^^^^^^^^^^^^
KeyError: 'reply_to'

======================================================================
ERROR: test_processing_packets_lock (__main__.TestBridgeAdvanced.test_processing_packets_lock)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/engine/project/tests/test_bridge_advanced.py", line 527, in test_processing_packets_lock
    asyncio.run(run())
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 687, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/home/engine/project/tests/test_bridge_advanced.py", line 525, in run
    self.assertEqual(len(state.reception_stats), 2)
                         ^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'MessageState' object has no attribute 'reception_stats'. Did you mean: 'reception_list'?

======================================================================
ERROR: test_update_matrix_message_with_replies (__main__.TestBridgeAdvanced.test_update_matrix_message_with_replies)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/engine/project/tests/test_bridge_advanced.py", line 358, in test_update_matrix_message_with_replies
    asyncio.run(run())
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 687, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/home/engine/project/tests/test_bridge_advanced.py", line 343, in run
    child1 = MessageState(packet_id=601, parent_packet_id=600, sender="!s1", text="üëç")
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: MessageState.__init__() missing 1 required positional argument: 'matrix_event_id'

======================================================================
FAIL: test_deep_search_reply_id (__main__.TestBridgeAdvanced.test_deep_search_reply_id)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/engine/project/tests/test_bridge_advanced.py", line 90, in test_deep_search_reply_id
    self.assertEqual(reply_id, 33333)
AssertionError: 0 != 33333

======================================================================
FAIL: test_find_reply_id_from_decoded_reply (__main__.TestBridgeAdvanced.test_find_reply_id_from_decoded_reply)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/engine/project/tests/test_bridge_advanced.py", line 61, in test_find_reply_id_from_decoded_reply
    self.assertEqual(reply_id, 67890)
AssertionError: 0 != 67890

======================================================================
FAIL: test_handle_duplicate_message_aggregates_stats (__main__.TestBridgeAdvanced.test_handle_duplicate_message_aggregates_stats)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/engine/project/tests/test_bridge_advanced.py", line 282, in test_handle_duplicate_message_aggregates_stats
    asyncio.run(run())
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 687, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/home/engine/project/tests/test_bridge_advanced.py", line 277, in run
    self.assertEqual(len(state.reception_stats), 2)
AssertionError: 1 != 2

======================================================================
FAIL: test_handle_duplicate_message_same_gateway_ignored (__main__.TestBridgeAdvanced.test_handle_duplicate_message_same_gateway_ignored)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/engine/project/tests/test_bridge_advanced.py", line 310, in test_handle_duplicate_message_same_gateway_ignored
    asyncio.run(run())
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 687, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/home/engine/project/tests/test_bridge_advanced.py", line 308, in run
    self.bridge.matrix_bot.edit_message.assert_not_called()
  File "/usr/lib/python3.12/unittest/mock.py", line 905, in assert_not_called
    raise AssertionError(msg)
AssertionError: Expected 'edit_message' to not have been called. Called 1 times.
Calls: [call('$original4', '[!sender]: Original\n*(!gw1 (-81dBm/8.9dB))*', '<b>[!sender]</b>: Original<br><small>(!gw1 (-81dBm/8.9dB))</small>')].

======================================================================
FAIL: test_parse_legacy_reaction_ignores_own_echo (__main__.TestBridgeAdvanced.test_parse_legacy_reaction_ignores_own_echo)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/engine/project/tests/test_bridge_advanced.py", line 118, in test_parse_legacy_reaction_ignores_own_echo
    self.assertEqual(reply_id, 0)  # Should ignore own echo
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError: 22222 != 0

======================================================================
FAIL: test_search_reply_fields (__main__.TestBridgeAdvanced.test_search_reply_fields)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/engine/project/tests/test_bridge_advanced.py", line 76, in test_search_reply_fields
    self.assertEqual(reply_id, 55555)
AssertionError: 0 != 55555

======================================================================
FAIL: test_update_matrix_message_compact_mode_initial (__main__.TestBridgeAdvanced.test_update_matrix_message_compact_mode_initial)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/engine/project/tests/test_bridge_advanced.py", line 383, in test_update_matrix_message_compact_mode_initial
    asyncio.run(run())
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 687, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/home/engine/project/tests/test_bridge_advanced.py", line 381, in run
    self.assertIn("!gw", content)  # Should include stats
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError: '!gw' not found in ''

----------------------------------------------------------------------
Ran 33 tests in 0.031s

FAILED (failures=7, errors=5)


============================================================
TEST SUMMARY
============================================================

Test Files: 1/7 passed

Individual Tests:
  ‚úÖ Passed:  77
  ‚ùå Failed:  12
  ‚ö†Ô∏è  Errors:  16
  ‚è≠Ô∏è  Skipped: 0
  üìä Total:   105

Pass Rate: 73.3%

Per-File Results:
  ‚úÖ /home/engine/project/tests/test_bridge.py   6/  6 passed
  ‚ùå /home/engine/project/tests/test_coverage_extended.py  17/ 22 passed, 5 errors
  ‚ùå /home/engine/project/tests/test_database.py   9/ 13 passed, 4 errors
  ‚ùå /home/engine/project/tests/test_matrix_bot.py   9/ 12 passed, 2 failed, 1 errors
  ‚ùå /home/engine/project/tests/test_meshtastic_interface.py   9/ 11 passed, 2 failed
  ‚ùå /home/engine/project/tests/test_mqtt_client.py   6/  8 passed, 1 failed, 1 errors
  ‚ùå /home/engine/project/tests/test_bridge_advanced.py  21/ 33 passed, 7 failed, 5 errors
============================================================
